

üõ°Ô∏è Service Creation by Attackers & SIEM Detection

Attackers often create or modify Windows services to maintain persistence and escalate privileges. Services usually run with SYSTEM-level rights and auto-start with Windows, making them a prime target.

‚∏ª

üîπ 1. Using sc.exe create (Command-Line)

Attack Example

sc.exe create EvilService binPath= "C:\malware\evil.exe" start= auto

Detection in SIEM
	‚Ä¢	Event ID 4688 ‚Üí Process creation (sc.exe create)
	‚Ä¢	Event ID 4697 ‚Üí Service installation (if enabled)
	‚Ä¢	Event ID 7045 ‚Üí ‚ÄúA new service was installed‚Äù (System log)

KQL Example

SecurityEvent
| where EventID in (4688, 4697)
| where CommandLine has_all ("sc.exe", "create") or CommandLine has "binPath="


‚∏ª

üîπ 2. PowerShell New-Service

Attack Example

New-Service -Name EvilService -BinaryPathName "C:\malware\evil.exe" -StartupType Automatic

Detection in SIEM
	‚Ä¢	Event ID 4104 ‚Üí ScriptBlock logging (‚ÄúNew-Service‚Äù)
	‚Ä¢	Event ID 7045 ‚Üí New service creation

KQL Example

SecurityEvent
| where EventID == 4104
| where ScriptBlockText has "New-Service"


‚∏ª

üîπ 3. Registry Key Creation (Service Registry Entries)

Attack Path

HKLM\SYSTEM\CurrentControlSet\Services\<ServiceName>

Detection in SIEM
	‚Ä¢	Sysmon Event ID 13 ‚Üí Registry value set (ImagePath)

KQL Example

Sysmon
| where EventID == 13
| where TargetObject startswith "HKLM\\System\\CurrentControlSet\\Services"


‚∏ª

üîπ 4. WMI-Based Service Creation

Attack Example

(Get-WmiObject -List Win32_Service).Create("MaliciousService","Malicious Service","C:\malware\evil.exe",16,0,"LocalSystem","")

Detection in SIEM
	‚Ä¢	Event ID 4688 ‚Üí wmic service creation
	‚Ä¢	Sysmon Event ID 1 ‚Üí wmiprvse.exe spawning unusual processes
	‚Ä¢	Event IDs 5857/5858 ‚Üí WMI Activity

KQL Example

SecurityEvent
| where EventID == 4688
| where CommandLine has "wmic" and CommandLine has "service"


‚∏ª

üîπ 5. PsExec or Remote Service Abuse

Attack Behavior
	‚Ä¢	PsExec installs a temporary service PSEXESVC on remote host.

Detection in SIEM
	‚Ä¢	Event ID 7045 ‚Üí Service PSEXESVC installed
	‚Ä¢	Event ID 4624 (LogonType 3) ‚Üí Network logon by admin account

KQL Example

SecurityEvent
| where EventID == 7045
| where ServiceName == "PSEXESVC"


‚∏ª

üîπ 6. Service Hijacking (Existing Services)

Attack Behavior
	‚Ä¢	Modify registry ImagePath of legitimate service to point to malicious binary.

Detection in SIEM
	‚Ä¢	Sysmon Event ID 13 ‚Üí Registry modification
	‚Ä¢	Look for ImagePath pointing to suspicious paths (e.g., %TEMP%, C:\Users\Public\).

KQL Example

Sysmon
| where EventID == 13
| where TargetObject endswith "\\ImagePath"
| where Details matches regex @"(Users|AppData|Temp)"


‚∏ª

üîπ 7. LOLBins (InstallUtil / msiexec)

Attack Behavior
	‚Ä¢	Abuses built-in binaries (InstallUtil.exe, msiexec.exe) to install services.

Detection in SIEM
	‚Ä¢	Event ID 4688 ‚Üí Process creation with InstallUtil.exe, msiexec.exe
	‚Ä¢	Event ID 7045 ‚Üí New service registered

KQL Example

SecurityEvent
| where EventID == 4688
| where Process has_any ("InstallUtil.exe", "msiexec.exe")


‚∏ª

üîπ Summary Table

Attack Method	Event IDs to Monitor	Key Detection Clues
sc.exe create	4688, 4697, 7045	CommandLine ‚Äúsc create‚Äù, new service logs
PowerShell New-Service	4104, 7045	ScriptBlock ‚ÄúNew-Service‚Äù
Registry service entry	Sysmon 13	New subkeys under Services\*, ImagePath mods
WMI Win32_Service	4688, Sysmon 1, 5857/5858	wmic ‚Ä¶ service or WMI spawning processes
PsExec (PSEXESVC)	7045, 4624 (LogonType 3)	ServiceName = PSEXESVC
Service hijacking	Sysmon 13	ImagePath edits to odd paths
LOLBins (InstallUtil, etc.)	4688, 7045	Rare executables + new services


‚∏ª
