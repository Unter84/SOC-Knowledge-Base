â¸»

1ï¸âƒ£ AD Replication Abuse â€” DCSync & DCShadow

ğŸ”¹ How the attack works
	â€¢	DCSync:
	â€¢	Attackers with replication rights (like Domain Admins or accounts with Replicating Directory Changes permissions) can pretend to be a Domain Controller and request replication data from a real DC.
	â€¢	This allows them to pull password hashes for all domain accounts â†’ enabling pass-the-hash, cracking, persistence.
	â€¢	Tools: mimikatz lsadump::dcsync.
	â€¢	DCShadow:
	â€¢	Attackers inject a rogue Domain Controller into AD replication topology.
	â€¢	Then they can push malicious changes (e.g., create a backdoor admin account, add SIDHistory) directly into AD without generating normal change events.
	â€¢	Tools: mimikatz lsadump::dcshadow.

ğŸ”¹ Log traces
	â€¢	Security Event ID 4662: â€œAn operation was performed on an objectâ€ with replication GUIDs (indicates replication rights used).
	â€¢	Directory Service logs: replication topology or replication requests (1311, 1988, 2042).
	â€¢	Azure AD / AD logs showing new DC registration or topology change without admin change control.

ğŸ”¹ SOC use
	â€¢	If you see replication events coming from non-DC hosts, thatâ€™s a red flag â†’ likely DCSync.
	â€¢	If you see new replication partner / topology changes outside of normal patching, could be DCShadow.

â¸»

2ï¸âƒ£ Malicious LDAP Enumeration

ğŸ”¹ How the attack works
	â€¢	LDAP is the protocol AD uses for directory queries (users, groups, computers).
	â€¢	Attackers who get any domain credentials often query AD to:
	â€¢	List all users and groups.
	â€¢	Find SPNs for Kerberoasting.
	â€¢	Discover where Domain Admins log in.
	â€¢	Tools: ldapsearch, PowerShell (Get-ADUser), BloodHound, SharpHound.

ğŸ”¹ Log traces
	â€¢	Event ID 1644 (Directory Service): Logs expensive LDAP queries (queries that return large results or scan wide parts of AD).
	â€¢	Security Event IDs (4662, object access) if auditing is enabled.

ğŸ”¹ SOC use
	â€¢	Normal apps query AD too, but if you see large, unusual LDAP queries from endpoints that arenâ€™t apps/servers, thatâ€™s suspicious.
	â€¢	Example: A workstation suddenly querying for all users with SPNs.

â¸»

3ï¸âƒ£ Insecure LDAP Binds

ğŸ”¹ How the attack works
	â€¢	By default, AD allows simple LDAP binds over cleartext (TCP/389).
	â€¢	If apps or services use this, attackers can:
	â€¢	Sniff credentials in plaintext on the wire.
	â€¢	Use LDAP relay attacks (abuse authentication to escalate privileges).
	â€¢	Safer: use LDAPS (TCP/636) or enforce secure binds.

ğŸ”¹ Log traces
	â€¢	Event IDs 2887â€“2889 in Directory Service:
	â€¢	2887: Insecure LDAP bind occurred.
	â€¢	2888: How many insecure binds in last 24 hrs.
	â€¢	2889: Which account made them.

ğŸ”¹ SOC use
	â€¢	Flag accounts or apps that still use insecure binds â†’ theyâ€™re high risk.
	â€¢	If you see a spike of insecure binds from unexpected hosts, an attacker may be relaying LDAP sessions.

â¸»

4ï¸âƒ£ Unusual Object Creation / Group Membership Changes

ğŸ”¹ How the attack works
	â€¢	Attackers, once inside AD, escalate privileges by:
	â€¢	Creating a new user and adding to Domain Admins.
	â€¢	Adding themselves to Enterprise Admins or sensitive groups.
	â€¢	Modifying existing objects (e.g., Service Principal Names for Kerberoasting).

ğŸ”¹ Log traces
	â€¢	Security Log Events:
	â€¢	4720: User account created
	â€¢	4728: Added to Global Group
	â€¢	4729: Removed from Global Group
	â€¢	4732: Added to Local Group
	â€¢	4733: Removed from Local Group
	â€¢	4722: User enabled
	â€¢	Directory Service logs: may also show replication/object change traces.

ğŸ”¹ SOC use
	â€¢	Build Splunk correlation searches: If new account is created and immediately added to Domain Admins, alert high.
	â€¢	Cross-reference with change control tickets â€” if no change control, escalate.

â¸»

5ï¸âƒ£ AD Service Disruption Attempts

ğŸ”¹ How the attack works
	â€¢	Attackers may try to crash or corrupt AD services to disrupt operations or cover tracks.
	â€¢	Examples:
	â€¢	Force replication errors (preventing admin changes from spreading).
	â€¢	Tamper with AD database (NTDS.dit).
	â€¢	Shut down AD DS service.

ğŸ”¹ Log traces
	â€¢	Directory Service event IDs:
	â€¢	1311, 1566: replication errors
	â€¢	2042: tombstone expired â†’ replication blocked
	â€¢	2100â€“2200: database/service errors
	â€¢	Unexpected service stops/restarts (System log).

ğŸ”¹ SOC use
	â€¢	If a critical DC suddenly logs replication failures with multiple peers, check if itâ€™s attacker-driven.
	â€¢	Correlate with suspicious activity on that DC (logons, processes).

â¸»

ğŸ“Œ Summary for Analysts
	â€¢	DCSync/DCShadow = abusing replication â†’ steal hashes or inject malicious changes.
	â€¢	LDAP Enumeration = large directory queries â†’ attacker recon.
	â€¢	Insecure LDAP Binds = weak configs attackers can sniff/relay.
	â€¢	Object/Group Changes = persistence & privilege escalation.
	â€¢	Service Disruption = crashing or tampering with AD to hide activity or deny service.

ğŸ‘‰ All these leave traces in ActiveDirectory-DomainService logs (and Security logs). SOC analysts monitor for unusual patterns in those event IDs to spot early-stage domain compromise.

â¸»
